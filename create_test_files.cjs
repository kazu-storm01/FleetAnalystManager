const XLSX = require('xlsx');

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ10åã¡ã‚‡ã†ã©ï¼‰
const minimalData = [
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ1', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ2', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ3', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ4', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ5', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ6', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ7', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ8', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ9', 'URL': '', 'å‚™è€ƒ': '' },
  { 'å¿œå‹Ÿè€…å': 'ãƒ†ã‚¹ãƒˆ10', 'URL': '', 'å‚™è€ƒ': '' }
];

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ100åï¼‰
const largeData = Array.from({ length: 100 }, (_, i) => ({
  'å¿œå‹Ÿè€…å': `å¤§é‡ãƒ‡ãƒ¼ã‚¿${i + 1}`,
  'URL': `https://example.com/user${i + 1}`,
  'å‚™è€ƒ': `ã“ã‚Œã¯${i + 1}ç•ªç›®ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚\næ”¹è¡Œã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚`
}));

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿
const specialCharsData = [
  { 'å¿œå‹Ÿè€…å': 'ç‰¹æ®Šæ–‡å­—ãƒ†ã‚¹ãƒˆâ‘ ', 'URL': 'https://example.com/ç‰¹æ®Šæ–‡å­—', 'å‚™è€ƒ': 'â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©' },
  { 'å¿œå‹Ÿè€…å': 'çµµæ–‡å­—ãƒ†ã‚¹ãƒˆğŸ˜Š', 'URL': 'https://example.com/emoji', 'å‚™è€ƒ': 'ğŸš¢âš“ğŸŒŠğŸ’™' },
  { 'å¿œå‹Ÿè€…å': 'è¨˜å·ãƒ†ã‚¹ãƒˆ!@#$%', 'URL': 'https://example.com/symbols', 'å‚™è€ƒ': '!@#$%^&*()_+-=[]{}|;:,.<>?' },
  { 'å¿œå‹Ÿè€…å': 'é•·ã„åå‰ã®ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ã§ã™', 'URL': 'https://example.com/very-long-url-that-might-cause-issues-with-column-width', 'å‚™è€ƒ': 'ã“ã‚Œã¯éå¸¸ã«é•·ã„å‚™è€ƒæ¬„ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚æ”¹è¡Œã‚‚å«ã‚ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå‡¦ç†ã§ãã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n\nè¤‡æ•°è¡Œã«ã‚ãŸã‚‹é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚' },
  { 'å¿œå‹Ÿè€…å': 'ç©ºç™½ãƒ†ã‚¹ãƒˆ', 'URL': '   ', 'å‚™è€ƒ': '   ' },
  { 'å¿œå‹Ÿè€…å': '   ', 'URL': 'https://example.com/whitespace', 'å‚™è€ƒ': 'å‰å¾Œã«ç©ºç™½ãŒã‚ã‚Šã¾ã™' },
  { 'å¿œå‹Ÿè€…å': 'æ”¹è¡Œãƒ†ã‚¹ãƒˆ\næ”¹è¡Œ', 'URL': 'https://example.com/newline', 'å‚™è€ƒ': 'æ”¹è¡Œ\nãŒ\nå«ã¾ã‚Œã¦\nã„ã¾ã™' },
  { 'å¿œå‹Ÿè€…å': 'ã‚¿ãƒ–ãƒ†ã‚¹ãƒˆ\tã‚¿ãƒ–', 'URL': 'https://example.com/tab', 'å‚™è€ƒ': 'ã‚¿ãƒ–\tãŒ\tå«ã¾ã‚Œã¦\tã„ã¾ã™' },
  { 'å¿œå‹Ÿè€…å': 'ã‚¯ã‚©ãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ"å¼•ç”¨ç¬¦"', 'URL': 'https://example.com/quotes', 'å‚™è€ƒ': '"ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ"ã¨\'ã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆ\'ã®ãƒ†ã‚¹ãƒˆ' },
  { 'å¿œå‹Ÿè€…å': 'ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ\\', 'URL': 'https://example.com/backslash', 'å‚™è€ƒ': 'ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥\\ã®ãƒ†ã‚¹ãƒˆ' }
];

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹4: ç©ºã®ãƒ‡ãƒ¼ã‚¿
const emptyData = [];

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹5: åˆ—åãŒç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿
const differentColumnsData = [
  { 'åå‰': 'åˆ—åãƒ†ã‚¹ãƒˆ1', 'ãƒªãƒ³ã‚¯': 'https://example.com/test1', 'ãƒ¡ãƒ¢': 'åˆ—åãŒç•°ãªã‚‹ãƒ†ã‚¹ãƒˆ' },
  { 'åå‰': 'åˆ—åãƒ†ã‚¹ãƒˆ2', 'ãƒªãƒ³ã‚¯': 'https://example.com/test2', 'ãƒ¡ãƒ¢': 'å¿œå‹Ÿè€…åã§ã¯ãªãåå‰' },
  { 'åå‰': 'åˆ—åãƒ†ã‚¹ãƒˆ3', 'ãƒªãƒ³ã‚¯': 'https://example.com/test3', 'ãƒ¡ãƒ¢': 'URLã§ã¯ãªããƒªãƒ³ã‚¯' }
];

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹6: ä¸è¶³ãƒ‡ãƒ¼ã‚¿ï¼ˆ9åã®ã¿ï¼‰
const insufficientData = Array.from({ length: 9 }, (_, i) => ({
  'å¿œå‹Ÿè€…å': `ä¸è¶³ãƒ‡ãƒ¼ã‚¿${i + 1}`,
  'URL': `https://example.com/insufficient${i + 1}`,
  'å‚™è€ƒ': `ã“ã‚Œã¯${i + 1}ç•ªç›®ã®ä¸è¶³ãƒ‡ãƒ¼ã‚¿ã§ã™`
}));

// ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹7: éå¸¸ã«é•·ã„ãƒ‡ãƒ¼ã‚¿
const veryLongData = [
  {
    'å¿œå‹Ÿè€…å': 'éå¸¸ã«é•·ã„åå‰ã‚’æŒã¤å¿œå‹Ÿè€…ã§ã™ã€‚ã“ã®åå‰ã¯æ„å›³çš„ã«é•·ãã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºã‚„å‡¦ç†ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚Œã¾ã—ãŸã€‚',
    'URL': 'https://example.com/very-long-name-test-this-url-is-also-very-long-to-test-column-width-and-text-wrapping-functionality',
    'å‚™è€ƒ': 'ã“ã‚Œã¯éå¸¸ã«é•·ã„å‚™è€ƒæ¬„ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚æ”¹è¡Œã‚‚å«ã‚ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãå‡¦ç†ã§ãã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚\n\nè¤‡æ•°è¡Œã«ã‚ãŸã‚‹é•·ã„ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\n\nã•ã‚‰ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ã€ã‚ˆã‚Šå³ã—ã„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚\n\nã“ã‚Œã§ååˆ†ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã«ãªã£ãŸã¯ãšã§ã™ã€‚'
  }
];

// ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆé–¢æ•°
function createXLSXFile(data, filename, sheetName = "å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆ") {
  if (data.length === 0) {
    console.log(`âš ï¸  ${filename}: ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—`);
    return;
  }

  const worksheet = XLSX.utils.json_to_sheet(data);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
  
  // åˆ—å¹…ã‚’è‡ªå‹•èª¿æ•´
  if (data.length > 0) {
    const cols = Object.keys(data[0]).map(key => ({
      wch: Math.max(20, ...data.map(row => row[key] ? String(row[key]).length : 0), key.length)
    }));
    worksheet['!cols'] = cols;
  }

  XLSX.writeFile(workbook, filename);
  console.log(`âœ… ${filename}: ${data.length}åã®ãƒ‡ãƒ¼ã‚¿ã§ä½œæˆ`);
}

// ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
console.log('ğŸ§ª ãƒ†ã‚¹ãƒˆç”¨XLSXãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­...\n');

createXLSXFile(minimalData, 'test_minimal_10.xlsx');
createXLSXFile(largeData, 'test_large_100.xlsx');
createXLSXFile(specialCharsData, 'test_special_chars.xlsx');
createXLSXFile(emptyData, 'test_empty.xlsx');
createXLSXFile(differentColumnsData, 'test_different_columns.xlsx');
createXLSXFile(insufficientData, 'test_insufficient_9.xlsx');
createXLSXFile(veryLongData, 'test_very_long.xlsx');

console.log('\nğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼');
console.log('\nğŸ“‹ ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¸€è¦§:');
console.log('1. test_minimal_10.xlsx - æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ10åã¡ã‚‡ã†ã©ï¼‰');
console.log('2. test_large_100.xlsx - å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆ100åï¼‰');
console.log('3. test_special_chars.xlsx - ç‰¹æ®Šæ–‡å­—ãƒ»çµµæ–‡å­—ãƒ»è¨˜å·ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿');
console.log('4. test_empty.xlsx - ç©ºã®ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆï¼‰');
console.log('5. test_different_columns.xlsx - åˆ—åãŒç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿');
console.log('6. test_insufficient_9.xlsx - ä¸è¶³ãƒ‡ãƒ¼ã‚¿ï¼ˆ9åã®ã¿ï¼‰');
console.log('7. test_very_long.xlsx - éå¸¸ã«é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿'); 